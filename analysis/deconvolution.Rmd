---
title: "Deconvolution"
author: "Dongyue Xie"
date: "2019-12-10"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

## Introduction


```{r}

set.seed(12345)

library(deconvSeq)

data("data_celltypes_rnaseq") 

dge.celltypes = getdge(cnts.celltypes, design.rnaseq, ncpm.min=1, nsamp.min=4)

A = dge.celltypes$counts%*%(design.rnaseq/(outer(rep(1,64),c(14,14,14,22))))

w = c(0.1,0.4,0.3,0.2)

######

Ey = A%*%w
e = rnorm(500,0,0.1)

y = Ey + e

# 1. ols est

what_ols = solve(t(A)%*%A)%*%t(A)%*%y
what_ols

# 2. nnls est

library(nnls)
what_nnls = nnls(A,y)
what_nnls$x

#######

c=10

Ey = c*A%*%w

y = Ey + e

what_ols = solve(t(A)%*%A)%*%t(A)%*%y


what_nnls = nnls(A,y)$x

D =t(A)%*%A

d = t(A)%*%y

Amat = diag(4)

Amat = rbind(rep(1,4),Amat)

b0 = c(1,0,0,0,0)

#what_qp = solve.QP(D,d,t(Amat),b0,meq=1)

#what_glmnet = glmnet(A,y,lambda = 0,lower.limits = 0,upper.limits = 1)

#what_bvls = bvls(A,y,rep(0,4),rep(1,4))

########

y = c*(A%*%w+e)

what_ols = solve(t(A)%*%A)%*%t(A)%*%y

nnls(A,y)$x

```

